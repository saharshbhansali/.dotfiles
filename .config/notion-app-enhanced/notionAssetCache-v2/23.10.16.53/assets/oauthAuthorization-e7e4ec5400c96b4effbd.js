"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[370],{93683:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Ce});var o=i(98135),s=i.n(o),n=i(59713),r=i.n(n),a=(i(33948),i(85827),i(15306),i(67294)),d=i.n(a),l=i(3779),c=i(66832),h=i(82990),g=i(72693),u=i(47966),p=i(36110),m=i(67154),S=i.n(m),v=i(37871),y=i(83071),f=i(1101),k=i(27832),b=i(81236),w=i(17364),P=i(5366),M=i(45094),A=i(98285),x=i(38755),I=i(34277),Z=i(31280),C=i(34011);class z extends Z.g6{renderAccountHeader(e){const t=w.Z.getUserEmailAddress(this.environment,e);return t&&s()(f.Z,{emailAddress:t,userId:e,disabled:!1,accountActions:[(0,I.qu)(e)]})}renderFooter(){return s()("div",{style:this.getFooterStyle()},void 0,s()(y.Z,{},void 0,v.k(this.environment)&&d().createElement(A.Z,S()({createType:"add-account",disableLoginLink:this.props.disableLoginLink},this.stores))))}getMenuListSections(e){const{device:t}=this.environment;return[{key:"spaces",render:e=>d().createElement(y.Z,S()({},e,{disableMobilePadding:!0,topBorder:t.isMobile,style:{borderBottom:"1px solid ".concat(this.theme.regularDividerColor)}})),items:this.getSpaceMenuListItems(e)}]}getSpaceMenuListItems(e){const{onSpaceClick:t}=this.props,i=[],{currentUserRootStore:o,currentSpaceStore:n}=k.default.state,r=w.Z.getSpaceViewStores(this.environment,e);if(!o||!n)return[];r.sort(((e,t)=>{var i,o;const s=Number(Boolean(null===(i=e.getSpaceStore())||void 0===i?void 0:i.canAdmin()));return Number(Boolean(null===(o=t.getSpaceStore())||void 0===o?void 0:o.canAdmin()))-s}));for(const a of r){const r=a.getSpaceStore();if(r){const l=e===o.id&&r.id===n.id,c=(0,x.getSpaceName)(this.environment,r),h=!r.canRead();let g;const u=b.Z.getPublicSpaceData(this.environment,r.id);if(u){const e=u.productId?this.props.intl.formatMessage((0,M.em)(u.productId)):this.props.intl.formatMessage("team"===r.getPlanType()?M.js.teamTrialPlan:M.js.personalPlan);g=this.props.intl.formatMessage("personal"===r.getPlanType()?M.js.workspaceSubtitleWithoutMembers:M.js.workspaceSubtitleWithMembers,{numberOfWorkspaceMembers:this.props.intl.formatNumber(u.memberCount),planType:e})}i.push({key:a.id,render:e=>d().createElement(C.Z,S()({},e,{id:a.id,icon:(0,x.getSpaceIcon)(this.environment,r),title:c,caption:g,isCheck:l,showDragHandle:!1,disabled:h,disableTooltip:!h,tooltipMessage:s()(P.FormattedMessage,{id:"oauthAuthorizationPage.workspaceSwitcher.disabledWorkspace.tooltip",defaultMessage:"This integration can only be added by a member or admin."})})),action:async({event:e})=>{this.close(),l||await t({event:e,spaceViewStore:a})}})}}return i}getUnreadCountForOtherSpaces(){return 0}}const B=(0,P.injectIntl)(z);var T=i(29974),_=i(12318),N=i(68932),F=i(90031),E=i(9844),L=i(77420),W=i(4615),R=i(64215),U=i(8848),V=i(82036),D=i(56589),O=i(40039),j=i(9852),q=i(89101),H=i(26111),G=i(62213),Y=i(42402),K=i(21202),J=i(28020),Q=i(9714),$=i(48762),X=i(82970),ee=i(62727),te=i(25584),ie=i(14694),oe=i(79029),se=i(28452);class ne extends se.Z{renderComponent(){const{isMobile:e,nestingLevel:t}=this.props;return d().createElement($.Z,S()({},this.props,{title:s()(ie.Z,{childrenStyle:ne.sidebarChildrenStyle,left:this.renderLeftCheckbox(),icon:this.renderIcon(),isMobile:e,style:{marginLeft:8*t}},void 0,this.renderTitle())}))}renderLeftCheckbox(){return s()(X.Z,{size:16,checked:this.props.isChecked,onClick:this.props.onClick})}renderIcon(){const{store:e,isMobile:t}=this.props,i=e.getIcon();return s()(O.Z,{disabled:!0,icon:i,title:void 0,isEmptyPage:e.isEmptyPage(),size:t?24:20,pageIconStyle:{fill:this.theme.mediumIconColor}})}renderTitle(){return s()(oe.Z,{store:this.props.store})}}r()(ne,"sidebarChildrenStyle",{display:"flex",alignItems:"center"});const re=ne;var ae=i(66722),de=i(59054),le=i(58879),ce=i(31299),he=i(71202),ge=i(24042),ue=i(16328),pe=i(78948),me=i(27006),Se=i(97880);function ve(e){const{spaceId:t,onSelectPage:i,query:o,source:n,findSelectedBlockAncestorId:r}=e,a=(0,le.O7)();let l=null;const[{status:c,value:h}]=(0,de.r5)((async()=>await ce.kz({environment:a,query:o,limit:10,requireEditPermissions:!0,spaceId:t,excludeTemplates:!0,source:n})),[a,o,t,n],{debounce:ce.vp});if("idle"===c||"pending"===c)l=s()(y.Z,{},void 0,s()(pe.Z,{}));else{const e=((null==h?void 0:h.results)||[]).map((({id:e})=>{const t=new Q.Z(a,{table:K.iU,id:e});return function(e){const{store:t,environment:i,alreadySelectedAncestorId:o,onSelectPage:n}=e;if(o&&o===t.id)return{key:t.id,action:()=>{},render:e=>d().createElement(ge.Z,S()({},e,{store:t,hidePath:!0,disabled:!0,style:{opacity:.5},caption:s()(P.FormattedMessage,{id:"oauthPageSearchResults.disabledResult.bySelf.message",defaultMessage:"Already added"})}))};if(o){const e=new Q.Z(i,{table:K.iU,id:o});return{key:t.id,action:()=>{},render:i=>d().createElement(ge.Z,S()({},i,{store:t,hidePath:!0,disabled:!0,style:{opacity:.5},caption:s()(P.FormattedMessage,{id:"oauthPageSearchResults.disabledResult.byAncestor.message",defaultMessage:"Already added via {ancestorPageName}",values:{ancestorPageName:s()(oe.Z,{store:e,style:{display:"inline"}})}})}))}}const r=t.getRole();return r&&me.zz(r)?{key:t.id,action:()=>n(t.id),render:e=>d().createElement(ge.Z,S()({store:t,hidePath:!1},e))}:void 0}({store:t,alreadySelectedAncestorId:r(t),environment:a,onSelectPage:i})})).filter(Se.$K);l=0===e.length?s()(y.Z,{},void 0,s()(ue.Z,{title:s()(P.FormattedMessage,{id:"oauthPageSearchResults.noResults.placeholder",defaultMessage:"No results"})})):function(e){return s()(te.Z,{type:te.Z.Type.Vertical,initialFocus:void 0,sections:[{key:"results",items:e,render:e=>d().createElement(y.Z,e)}]})}(e)}const g={menuType:he.ZP.MenuType.Popup};return d().createElement(he.ZP,g,l)}var ye=i(81997);class fe extends c.Z{constructor(...e){super(...e),r()(this,"sidebarState",this.createComputedStore((()=>(0,J.vK)(this.environment)))),r()(this,"storeTypes",{selectedBlockIdsStore:_.Z.of({}),searchStore:_.Z.of({open:!1,query:void 0})}),r()(this,"getPageSection",((e,t,i)=>{const o=i.filter((e=>me.zz(e.getRole()||"none")));return{key:e,render:e=>d().createElement(y.Z,e),items:[this.getPageSectionHeader(t,o),...0===o.length?[this.getEmptyState()]:o.map((e=>this.getPageItem(e,1)))]}})),r()(this,"getPageItem",((e,t)=>{const{selectedBlockIdsStore:i}=this.stores,{device:o}=this.environment,s=i.state[e.id];return{key:e.id,action:()=>this.props.onClickPage(e.id,s),render:i=>d().createElement(re,S()({},i,{isMobile:o.isMobile,store:e,isChecked:s,disabled:!1,nestingLevel:t}))}})),r()(this,"getPageSectionHeader",((e,t)=>{const{selectedBlockIdsStore:i}=this.stores,{device:o}=this.environment,n=t.length>0&&t.every((e=>i.state[e.id]));return{key:e,action:()=>this.props.onClickSection(t),render:t=>d().createElement($.Z,S()({},t,{title:s()(ie.Z,{left:s()(X.Z,{onClick:t.onClick,checked:n,size:16}),isMobile:o.isMobile,style:this.getSectionHeaderStyle()},void 0,e)}))}})),r()(this,"getEmptyState",(()=>{const{device:e}=this.environment;return{key:"empty",action:()=>{},render:t=>d().createElement($.Z,S()({},t,{title:s()(ie.Z,{isMobile:e.isMobile,style:{fontSize:14,color:this.theme.mediumTextColor,padding:"2px 32px"}},void 0,s()(P.FormattedMessage,{id:"oauthAuthorizationPage.selectPageStep.empty",defaultMessage:"No pages inside"}))}))}})),r()(this,"handleSearchQueryChange",(e=>{const t=this.stores.searchStore.state,i=e.length>0;this.stores.searchStore.setState({...t,query:e,open:i})})),r()(this,"handleSearchCancel",(()=>{const e=this.stores.searchStore.state;this.stores.searchStore.setState({...e,open:!1,query:void 0})})),r()(this,"findSelectedBlockAncestorId",(e=>{const{selectedBlockIdsStore:t}=this.stores;if(t.state[e.id])return e.id;const i=ye.fJ(e).find((e=>e.table===K.iU&&t.state[e.value.id]));return i?i.value.id:void 0}))}renderComponent(){const{intl:e}=this.props,{searchStore:t,selectedBlockIdsStore:i}=this.stores,{device:o}=this.environment;if(!this.sidebarState.state)return s()(N.Z,{});const{allSharedPagesStores:n,showWorkspaceSection:r,showSharedSection:a,showPrivateSection:c,showOnlyPrivateSection:h}=this.sidebarState.state,{currentSpaceViewStore:g,currentSpaceStore:u}=k.default.state;if(!g||!u)return;const p=g.getWorkspacePages().filter((e=>e.state.value&&"copy_indicator"!==e.state.value.type)),m=g.getPrivatePages(this.environment).filter((e=>e.state.value&&"copy_indicator"!==e.state.value.type)),v=Object.keys(i.state).filter((e=>i.state[e])).map((e=>new Q.Z(this.environment,{table:K.iU,id:e}))).filter((e=>{var t;return(null===(t=e.state.value)||void 0===t?void 0:t.space_id)===u.id&&e.isNavigableBlock()&&!e.isTopLevelPrivatePage(u.id,this.environment)&&!e.isTopLevelWorkspacePage(u.id)&&!n.some((t=>t.id===e.id))})),f=(0,x.getSpaceName)(this.environment,u),b=[];if(v.length>0&&b.push({key:"manual",render:e=>d().createElement(y.Z,S()({},e,{title:s()(ie.Z,{isMobile:o.isMobile,style:this.getSectionHeaderStyle()},void 0,s()(P.FormattedMessage,{id:"oauthAuthorizationPage.selectPagesStep.pagePicker.manuallyAddedPagesSection.title",defaultMessage:"Manually added"})),isTitleUppercase:!0})),items:v.map((e=>this.getPageItem(e,0)))}),r&&b.push(this.getPageSection("workspace",e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.workspaceSection.title",defaultMessage:"Workspace",description:"This word is used in the same context as the title for the Workspace section of the sidebar."}),p)),a&&b.push(this.getPageSection("shared",e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.sharedSection.title",defaultMessage:"Shared",description:"This word is used in the same context as the title for the Shared section of the sidebar."}),n)),c){const t=h?f||"":e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.privateSection.title",defaultMessage:"Private",description:"This word is used in the same context as the title for the Private section of the sidebar."});b.push(this.getPageSection("private",t,m))}return d().createElement(d().Fragment,null,s()(ae.GI,{origin:s()(ee.Z,{focus:!0,focusAfterAnimation:!0,value:t.state.query||"",onChange:e=>{this.handleSearchQueryChange(e.target.value)},left:l.Z.searchThick(this.getSearchIconStyle()),placeholder:e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.search.placeholder",defaultMessage:"Search for pages in {workspaceName}"},{workspaceName:f})}),sameWidthAsOrigin:!0,popupType:ae.GI.PopupType.Popup,open:t.state.open,render:()=>s()(ve,{spaceId:u.id,onSelectPage:e=>this.props.onClickPage(e,!1),query:t.state.query||"",source:"oauth",findSelectedBlockAncestorId:this.findSelectedBlockAncestorId}),onDismiss:this.handleSearchCancel}),s()("div",{style:this.getPageListStyle()},void 0,s()(te.Z,{type:te.Z.Type.Vertical,sections:b,initialFocus:void 0})))}getSectionHeaderStyle(){return{textTransform:"uppercase",fontSize:12,fontWeight:600,color:this.theme.mediumTextColor,padding:"2px 0"}}getPageListStyle(){return{alignItems:"left",width:"100%",height:380,borderWidth:1,borderStyle:"solid",borderColor:U.ZP.contentBorder,overflowY:"auto"}}getSearchIconStyle(){return{width:14,height:14,marginLeft:8,marginRight:8,flexGrow:0,flexShrink:0,fill:this.theme.mediumIconColor}}}const ke=(0,P.injectIntl)(fe);var be=i(21325),we=i(78291),Pe=i(1643),Me=i(90965),Ae=i(15070),xe=i(95155);class Ie extends c.Z{constructor(...e){super(...e),r()(this,"storeTypes",{authorizationStepStore:_.Z.of("permissions"),selectedBlockIdsStore:_.Z.of({}),existingBotStore:_.Z.of(void 0)}),r()(this,"renderErrorOrAuthorizationPage",(()=>{const{responseType:e,integrationId:t}=this.props,{existingBotStore:i}=this.stores,{currentUserRootStore:o,currentSpaceStore:n,currentSpaceViewStore:r,currentUserSettingsStore:a}=k.default.state;if(!(o&&n&&r&&a))return;const d=(0,x.getSpaceName)(this.environment,n);if(!t||!(0,W.e)(t))return this.renderError({type:V._.invalid_request,body:s()(P.FormattedMessage,{id:"oauthAuthorizationPage.error.invalidClientId.body",defaultMessage:"Missing or incomplete Client ID. See <inlinetextlink>developer docs</inlinetextlink> for more help.",values:{inlinetextlink:(...e)=>s()(Y.Z,{href:"https://developers.notion.com/#handling-errors"},void 0,e)}}),integration:void 0});const l=(0,F.Kv)(o,{table:E.K,id:t});return l.isReady()?l.state.value?"code"!==e?this.renderError({type:V._.invalid_request,body:s()(P.FormattedMessage,{id:"oauthAuthorizationPage.error.invalidResponseType",defaultMessage:"Missing or invalid response_type. See <inlinetextlink>developer docs</inlinetextlink> for more help.",values:{inlinetextlink:(...e)=>s()(Y.Z,{href:"https://developers.notion.com/#handling-errors"},void 0,e)},description:"Do not translate 'response_type', it's code."}),integration:l.state.value}):i.state&&i.state.created_by_id!==o.id?this.renderError({type:V._.access_denied,title:s()(P.FormattedMessage,{id:"oauthAuthorizationPage.error.integrationAlreadyInstalled.title",defaultMessage:"This integration has already been added to {workspaceName}",values:{workspaceName:d}}),body:s()(P.FormattedMessage,{id:"oauthAuthorizationPage.error.integrationAlreadyInstalled.body",defaultMessage:"You can review and remove added integrations in Settings."}),integration:l.state.value,primaryAction:s()(g.Z,{isLarge:!0,onClick:()=>{p.Hx({environment:this.environment,spaceViewStore:r,spaceStore:n,userSettingsStore:a,userRootStore:o})}},void 0,s()(P.FormattedMessage,{id:"oauthAuthorizationPage.error.integrationAlreadyInstalled.openWorkspaceSettingsButton.label",defaultMessage:"Open Settings"}))}):this.renderAuthorizationPage(l.state.value):this.renderError({type:V._.invalid_request,body:s()(P.FormattedMessage,{id:"oauthAuthorizationPage.error.clientNotFound.body",defaultMessage:"Missing or incomplete Client ID. See <inlinetextlink>developer docs</inlinetextlink> for more help.",values:{inlinetextlink:(...e)=>s()(Y.Z,{href:"https://developers.notion.com/#handling-errors"},void 0,e)}}),integration:l.state.value}):s()(N.Z,{})})),r()(this,"initializeStores",(async()=>{const{selectedBlockIdsStore:e,existingBotStore:t}=this.stores,{currentUserRootStore:i,currentSpaceStore:o}=k.default.state;if(!i||!o)return;await be.bi(this.environment);const{data:s}=we.default.state;if(!s)return;const n=Pe.NM(s),r=await this.getExistingBot(n.map((e=>e.botId)));if(!r)return t.reset(),void e.reset();t.setState(r);const a=n.find((e=>e.botId===r.id));a&&e.setState(a.pageIds.reduce(((e,t)=>(e[t]=!0,e)),{}))})),r()(this,"getExistingBot",(async e=>{const{integrationId:t}=this.props,{currentUserRootStore:i,currentSpaceStore:o}=k.default.state;if(!i||!o)return;return(await Promise.all(e.map((async e=>{const t=(0,F.Kv)(i,{table:L.c,id:e,spaceId:o.id});return await t.load(),t.getValue()})))).find((e=>e&&e.alive&&(0,Ae.oA)(e)&&e.parent_id===i.id&&e.integration_id===t))})),r()(this,"switchToPagePickerStep",(()=>{this.stores.authorizationStepStore.setState("page_picker")})),r()(this,"switchToPermissionsStep",(()=>{this.stores.authorizationStepStore.setState("permissions")})),r()(this,"handleSpaceSwitch",(async e=>{const{spaceViewStore:t}=e;await T.ce({environment:this.environment,spaceViewStore:t}),await this.initializeStores()})),r()(this,"handleCancel",(e=>{p.VW({environment:this.environment,params:this.props,integration:e,errorType:V._.access_denied})})),r()(this,"handleAuthorize",((e,t)=>{const{selectedBlockIdsStore:i}=this.stores;p.VW({environment:this.environment,params:this.props,integration:e,spaceId:t,blockIdsForBot:Object.keys(i.state).filter((e=>i.state[e]))})})),r()(this,"handleClickPage",((e,t)=>{const{selectedBlockIdsStore:i}=this.stores;i.setState({...i.state,[e]:!t})})),r()(this,"handleClickSection",(e=>{const{selectedBlockIdsStore:t}=this.stores,i=e.every((e=>t.state[e.id]));t.setState({...t.state,...e.reduce(((e,t)=>(e[t.id]=!i,e)),{})})}))}willMount(){const{responseType:e,integrationId:t,redirectUri:i,state:o,owner:s}=this.props;j.setOauthAuthorizationParams({responseType:e,integrationId:t,redirectUri:i,state:o,owner:s})}async didMount(){const{currentSpaceStore:e,currentSpaceViewStore:t}=k.default.state;e&&t&&e.canAdmin()?await this.initializeStores():await this.setCurrentSpaceToFirstAdminSpace()}renderComponent(){const{currentSpaceStore:e}=k.default.state;if(e)return s()("div",{style:this.getLayoutContainerStyle()},void 0,s()("div",{style:this.getPageContainerStyle()},void 0,s()("div",{style:this.getContentBoxStyle()},void 0,this.renderTopbar(),s()("div",{style:this.getContentBodyStyle()},void 0,this.renderErrorOrAuthorizationPage()))))}renderAuthorizationPage(e){const{redirectUri:t}=this.props,{authorizationStepStore:i}=this.stores,{currentSpaceStore:o,currentSpaceViewStore:n}=k.default.state;if(!o||!n)return;const r=(0,x.getSpaceName)(this.environment,o),a="on"===xe.default.getGroup("integration-approvals");return o.state.value&&(a||!this.isOauthDisabledByAdmin||o.canAdmin())&&o.canRead()?!a||o.canAdmin()||this.isIntegrationAllowedByAdmin(e)?D._(e,t)?"permissions"===i.state?this.renderPermissionsStep(e,o):"page_picker"===i.state?this.renderPagePickerStep(e,o):(0,Se.t1)(i.state):this.renderError({type:V._.invalid_request,body:s()(P.FormattedMessage,{id:"oauthAuthorizationPage.error.invalidRedirectUri.body",defaultMessage:"Missing or invalid redirect_uri. See <inlinetextlink>developer docs</inlinetextlink> for more help.",values:{inlinetextlink:(...e)=>s()(Y.Z,{href:"https://developers.notion.com/#handling-errors"},void 0,e)},description:"Do not translate 'redirect_uri', it's code."}),integration:e}):this.renderError({type:V._.access_denied,title:s()(P.FormattedMessage,{id:"oauthAuthorizationPage.error.integrationNotApproved.title",defaultMessage:"You're not allowed to add this integration to {workspaceName}",values:{workspaceName:r}}),body:s()(P.FormattedMessage,{id:"oauthAuthorizationPage.error.integrationNotApproved.body",defaultMessage:"Contact an admin to approve this integration, or switch to another workspace."}),integration:e,primaryAction:s()(g.Z,{isLarge:!0,onClick:()=>G.Z.setState({...G.Z.state,open:!0})},void 0,s()(P.FormattedMessage,{id:"oauthAuthorizationPage.error.notAnAdmin.switchWorkspaceButton.label",defaultMessage:"Switch workspace"}))}):this.renderError({type:V._.access_denied,title:s()(P.FormattedMessage,{id:"oauthAuthorizationPage.error.notAnAdmin.title",defaultMessage:"You're not allowed to add integrations to {workspaceName}",values:{workspaceName:r}}),body:s()(P.FormattedMessage,{id:"oauthAuthorizationPage.error.notAnAdmin.body",defaultMessage:"Contact an admin to grant you access, or switch to another workspace."}),integration:e,primaryAction:s()(g.Z,{isLarge:!0,onClick:()=>G.Z.setState({...G.Z.state,open:!0})},void 0,s()(P.FormattedMessage,{id:"oauthAuthorizationPage.error.notAnAdmin.switchWorkspaceButton.label",defaultMessage:"Switch workspace"}))})}renderPermissionsStep(e,t){var i,o,n,r,a,c,g;const u=(0,x.getSpaceName)(this.environment,t),p=e.info.website_url,m=e.info.terms_of_use_url,S=e.info.privacy_policy_url,v=e.info.icon?{pointer:{table:E.K,id:e.id},icon:e.info.icon}:void 0,y=this.props.redirectUri?this.props.redirectUri.replace("http://","").replace("https://","").split(/[/?#]/)[0]:void 0;return d().createElement(d().Fragment,null,s()("div",{style:{padding:15}},void 0,s()(O.Z,{icon:v,disabled:!0,title:e.name,size:54,isEmptyPage:!1,style:{margin:"auto"}})),s()("div",{style:this.getTitleStyle()},void 0,s()(P.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.title",defaultMessage:"<inlinetextlink>{integrationName}</inlinetextlink> wants to access {workspaceName}",values:{integrationName:e.name,workspaceName:u,inlinetextlink:(...e)=>p?s()(Y.Z,{style:{...this.getInlineTextLinkStyle(),fontWeight:h.Z.fontWeight.semibold},href:p},void 0,e):e}})),s()("div",{style:{marginBottom:8}},void 0,s()(P.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.intro",defaultMessage:"<inlinetextlink>{integrationName}</inlinetextlink> wants to",values:{integrationName:e.name,inlinetextlink:(...e)=>p?s()(Y.Z,{href:p,style:this.getInlineTextLinkStyle()},void 0,e):e}})),(null===(i=e.capabilities)||void 0===i?void 0:i.read_content)&&s()(Ze,{icon:l.Z.eye,title:s()(P.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.permissionListItem.readContent",defaultMessage:"View pages you select",description:"This is one of the things an integration can do once it's added to a user's workspace."})},void 0,s()(P.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.permissionListItem.readContent.description",defaultMessage:'"{integrationName}" will be able to view pages you select in the next step. You can also share pages later with "{integrationName}" via the Share menu.',values:{integrationName:e.name,workspaceName:u}})),(null===(o=e.capabilities)||void 0===o?void 0:o.update_content)&&s()(Ze,{icon:l.Z.pencil,title:s()(P.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.permissionListItem.updateContent",defaultMessage:"Edit pages you select",description:"This is one of the things an integration can do once it's added to a user's workspace."})},void 0,s()(P.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.permissionListItem.updateContent.description",defaultMessage:'"{integrationName}" will be able to edit pages you select in the next step. You can also share pages later with "{integrationName}" via the Share menu.',values:{integrationName:e.name,workspaceName:u}})),(null===(n=e.capabilities)||void 0===n?void 0:n.insert_content)&&s()(Ze,{icon:l.Z.plus,title:s()(P.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.permissionListItem.insertContent",defaultMessage:"Create new content within pages you select",description:"This is one of the things an integration can do once it's added to a user's workspace."})},void 0,s()(P.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.permissionListItem.insertContent.description",defaultMessage:'"{integrationName}" will be able to add new content or sub-pages to pages you select in the next step. You can also share pages later with "{integrationName}" via the Share menu.',values:{integrationName:e.name,workspaceName:u}})),((null===(r=e.capabilities)||void 0===r?void 0:r.read_user_without_email)||(null===(a=e.capabilities)||void 0===a?void 0:a.read_user_with_email))&&s()(Ze,{icon:l.Z.settingsMembers,title:null!==(c=e.capabilities)&&void 0!==c&&c.read_user_with_email?s()(P.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.permissionListItem.viewUsersAndEmail",defaultMessage:"View workspace users and their emails",description:"This is one of the things an integration can do once it's added to a user's workspace."}):s()(P.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.permissionListItem.viewUsers",defaultMessage:"View workspace users",description:"This is one of the things an integration can do once it's added to a user's workspace."})},void 0,null!==(g=e.capabilities)&&void 0!==g&&g.read_user_with_email?s()(P.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.permissionListItem.viewUsersAndEmail.detail",defaultMessage:'"{integrationName}" will be able to see basic information about all workspace members and guest data, including their names, profile images, and email addresses.',values:{integrationName:e.name}}):s()(P.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.permissionListItem.viewUsers.detail",defaultMessage:'"{integrationName}" will be able to see basic information about all workspace members and guests, like their names and profile images, but not their email addresses.',values:{integrationName:e.name}})),this.renderOptionButtons({leftText:s()(P.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.cancelButton.label",defaultMessage:"Cancel"}),leftAction:()=>this.handleCancel(e),rightText:s()(P.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.continueButton.label",defaultMessage:"Select pages",description:"This button will take a user to a screen where they can choose pages to share with an integration."}),rightAction:this.switchToPagePickerStep}),s()("footer",{style:this.getFooterStyle()},void 0,s()("div",{style:{color:this.theme.regularTextColor,fontWeight:h.Z.fontWeight.semibold,marginBottom:4}},void 0," ",s()(P.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.warning.title",defaultMessage:'Make sure you trust "{integrationName}" ({redirectUriDomain})',values:{integrationName:e.name,redirectUriDomain:y}})),s()("div",{},void 0,s()(P.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.warning.body",defaultMessage:'If you continue, you may be sharing sensitive information. Notion does not review third party integrations such as "{integrationName}". Learn how "{integrationName}" handles your data by reviewing their <privacypolicylink>Privacy Policy</privacypolicylink> and <termsofservicelink>Terms of Service</termsofservicelink>.',values:{integrationName:e.name,privacypolicylink:(...e)=>S?s()(Y.Z,{href:S},void 0,e):e,termsofservicelink:(...e)=>m?s()(Y.Z,{href:m},void 0,e):e}}))))}renderPagePickerStep(e,t){return d().createElement(d().Fragment,null,s()("div",{style:this.getSubtitleStyle()},void 0,s()(P.FormattedMessage,{id:"oauthAuthorizationPage.selectPagesStep.title",defaultMessage:'Allow "{integrationName}" to access these pages',values:{integrationName:e.name}})),s()(ke,{onClickPage:this.handleClickPage,onClickSection:this.handleClickSection,selectedBlockIdsStore:this.stores.selectedBlockIdsStore}),this.renderOptionButtons({leftText:s()(P.FormattedMessage,{id:"oauthAuthorizationPage.selectPagesStep.backButton.label",defaultMessage:"Back"}),leftAction:this.switchToPermissionsStep,rightText:s()(P.FormattedMessage,{id:"oauthAuthorizationPage.selectPagesStep.finishButton.label",defaultMessage:"Allow access",description:"This button, once clicked, adds an integration to a user's workspace and automatically gives it access to a set of pages the user selected."}),rightAction:()=>this.handleAuthorize(e,t.id)}))}renderTopbar(){const{isMobile:e}=this.environment.device;return s()("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",height:60,paddingLeft:20,paddingRight:8,borderBottomWidth:1,borderBottomStyle:"solid",borderBottomColor:U.ZP.contentBorder}},void 0,l.Z.notionLogoStroked({width:e?28:30,height:e?28:30,marginRight:10,flexShrink:0}),s()("div",{style:{fontWeight:h.Z.fontWeight.medium,fontSize:16}},void 0,"Notion"),s()("div",{style:{flexGrow:1,flexShrink:1}}),s()("div",{style:{flexShrink:0}},void 0,s()(B,{format:Z._S.Regular,onSpaceClick:({spaceViewStore:e})=>this.handleSpaceSwitch({spaceViewStore:e}),shouldShowUnexpandButton:!1,disableLoginLink:!0,buttonStyle:{borderRadius:3,marginBottom:0}})))}renderOptionButtons(e){return s()("div",{style:this.getButtonGroupStyle()},void 0,s()(u.Z,{isLarge:!0,onClick:e.leftAction,style:{height:32}},void 0,e.leftText),s()(g.Z,{isLarge:!0,onClick:e.rightAction},void 0,e.rightText))}renderError({integration:e,type:t,title:i,body:o,primaryAction:n}){const r=i||s()(P.FormattedMessage,{id:"oauthAuthorizationPage.error.genericError.title",defaultMessage:"Something went wrong"});return s()("section",{style:this.getErrorContainerStyle()},void 0,l.Z.genericError(this.getErrorIconStyle()),s()("header",{style:{...this.getTitleStyle(),marginBottom:12}},void 0,r),o&&s()("p",{style:this.getErrorBodyStyle()},void 0,o),n&&s()("div",{style:this.getErrorBodyStyle()},void 0,n),s()(u.Z,{onClick:()=>{p.VW({environment:this.environment,integration:e,errorType:t,params:this.props})}},void 0,s()(P.FormattedMessage,{id:"oauthAuthorizationPage.error.cancelButton.label",defaultMessage:"Cancel"})))}get isOauthDisabledByAdmin(){const{currentSpaceStore:e}=k.default.state;if(!e||!e.state.value)return!1;return(0,Me.xI)(e.state.value).disablePersonalBots}isIntegrationAllowedByAdmin(e){const{currentSpaceStore:t}=k.default.state;if(!t||!t.state.value)return!1;const i=t.state.value.bot_settings;if(!i)return!0;if((0,Me.CJ)(i)){const t=i.integration_approval_statuses;return!(!t||!t[e.id])&&Boolean("approved"===t[e.id].status)}return!0}async setCurrentSpaceToFirstAdminSpace(){const{currentUserRootStore:e}=k.default.state;if(e){const t=e.getSpaceViewStores();if(t.length>0){const e=t.find((e=>e.canAdmin()));return void(await this.handleSpaceSwitch({spaceViewStore:e||t[0]}))}}H.navigate({environment:this.environment,url:q._j.login,redirect:!0})}getLayoutContainerStyle(){const{WindowSizeStore:e}=this.environment;return{height:"100%",overflow:"auto",backgroundColor:e.state.width>500?U.ZP.frontCreamBackground:U.ZP.white}}getPageContainerStyle(){return{display:"flex",justifyContent:"center"}}getContentBoxStyle(){const{WindowSizeStore:e}=this.environment,t=e.state.width>500,i=e.state.height<600?16:t?"calc((100vh - 600px) / 2)":0,o=t?this.theme.lightBoxShadow:"none";return{width:"500px",minHeight:"600px",borderRadius:5,backgroundColor:U.ZP.white,boxShadow:o,display:"flex",flexDirection:"column",fontSize:h.Z.fontSize.UIRegular.desktop,marginTop:i,transition:"all 0.2s ease"}}getContentBodyStyle(){return{paddingLeft:40,paddingRight:40,paddingTop:25,paddingBottom:25,flex:1,display:"flex",flexDirection:"column"}}getFooterStyle(){return{fontSize:h.Z.fontSize.UISmall.desktop,color:this.theme.mediumTextColor,paddingTop:32,paddingBottom:16}}getTitleStyle(){const{device:e}=this.environment;return{fontSize:e.isMobile?18:20,margin:"0 50px 32px",textAlign:"center",fontWeight:h.Z.fontWeight.medium}}getSubtitleStyle(){return{fontSize:14,textAlign:"center",fontWeight:h.Z.fontWeight.medium,marginBottom:16}}getButtonGroupStyle(){return{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:24}}getErrorContainerStyle(){return{textAlign:"center",flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}}getErrorIconStyle(){const{device:e}=this.environment,t=e.isMobile?25:48;return{fill:U.ZP.red,width:t,height:t,marginBottom:20,display:"inline-block"}}getErrorBodyStyle(){return{marginTop:0,marginBottom:24,width:"80%"}}getInlineTextLinkStyle(){return{borderBottom:"1px solid rgba(54, 53, 47, 0.2)",color:"black",textDecoration:"none"}}}function Ze(e){const[t,i]=(0,a.useState)(!1),o=(0,R.y)((e=>({permissionItem:{display:"flex",justifyContent:"space-between",padding:"6px 0",cursor:"pointer",userSelect:"none"},permissionItemHeading:{display:"flex",alignItems:"center"},permissionItemDetails:{paddingLeft:32,transition:"all 0.2s ease",color:e.mediumTextColor},rightStyle:{width:22,height:18},sharedIconStyle:{width:24,height:16,textAlign:"center",marginRight:8}})),[]);return d().createElement(d().Fragment,null,s()("div",{style:o.permissionItem,onClick:()=>i(!t)},void 0,s()("div",{style:o.permissionItemHeading},void 0,s()("div",{style:o.sharedIconStyle},void 0,e.icon({width:16,height:16,color:U.ZP.regularIconColor})),s()("div",{},void 0,e.title)),e.children&&s()("div",{},void 0,l.Z.chevronDownThin({width:12,height:12,color:U.ZP.lightIconColor,transform:t?"rotate(180deg)":void 0,transition:"transform 0.2s ease"}))),s()("div",{style:{...o.permissionItemDetails,opacity:t?1:0,flex:t?1:0,paddingBottom:t?8:0,transform:t?"translate3d(0,-4px,0)":"translate3d(0,-8px,0)"}},void 0,t&&e.children))}const Ce=(0,P.injectIntl)(Ie)}}]);